var StaadesRequest=function(){};StaadesRequest.prototype.baseUrl=function(t){return"https://api.staades.net/2.0/app/"+t.appKey},StaadesRequest.prototype.hash=function(t){var a,e,s,n=0;if(0==t.length)return n;for(a=0,s=t.length;s>a;a++)e=t.charCodeAt(a),n=(n<<5)-n+e,n|=0;return n},StaadesRequest.prototype.call=function(t,a,e){var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&200==s.status&&(responseObject=JSON.parse(s.responseText),void 0!==e?e(responseObject):t.valuesResult(responseObject)),4==s.readyState&&200!=s.status&&(responseObject=JSON.parse(s.responseText),t.errorResult(s.status,responseObject))},s.open("GET",this.baseUrl(t)+a,!0),s.setRequestHeader("apikey",t.apiKey),s.send()};var StaadesGraph=function(t,a,e){this.appKey=t,this.apiKey=a,this.options=e;var s=t;if(this.containerId=Math.floor(1e7*Math.random()+1),this.initGraphContainer(),this.request=new StaadesRequest,this.options.idents)for(var n in this.options.idents)s+=this.options.idents[n];this.containerHash=this.request.hash(s),window["staades"+this.containerId]=this,this.values()};StaadesGraph.prototype.errorResult=function(t,a){if(void 0!==a.message){var e=document.getElementById(this.options.containerId);e.insertAdjacentHTML("beforeend",'<span class="staades-graph-error">Response code: '+t+", "+a.message+"</span>")}},StaadesGraph.prototype.values=function(){void 0===this.graphObject&&this.initGraphObject(),this.resetGraphObject();var t=localStorage.getItem("staades"+this.containerHash+"range");null==t&&(t="1m");var a=localStorage.getItem("staades"+this.containerHash+"display");null==a&&(a="sum");for(var e=document.getElementById(this.options.containerId).getElementsByClassName("staades-graph-diff-btn"),s=0;s<e.length;s++)e[s].getAttribute("data-diff")==a?e[s].setAttribute("class","staades-graph-diff-btn staades-active"):e[s].setAttribute("class","staades-graph-diff-btn");if(this.options.idents)for(var n in this.options.idents)this.request.call(this,"/idents/"+this.options.idents[n]+"/aggregate/"+a+"?filter[range]="+t)},StaadesGraph.prototype.valuesResult=function(t){var a=localStorage.getItem("staades"+this.containerHash+"range");null==a&&(a="1m");for(var e=document.getElementById(this.options.containerId).getElementsByClassName("staades-graph-range-btn"),s=0;s<e.length;s++)"1h"==e[s].getAttribute("data-range")&&(void 0===t.links.range1h?e[s].setAttribute("class","staades-graph-range-btn staades-invisible"):e[s].getAttribute("data-range")==a?e[s].setAttribute("class","staades-graph-range-btn staades-active"):e[s].setAttribute("class","staades-graph-range-btn")),"1d"==e[s].getAttribute("data-range")&&(void 0===t.links.range1d?e[s].setAttribute("class","staades-graph-range-btn staades-invisible"):e[s].getAttribute("data-range")==a?e[s].setAttribute("class","staades-graph-range-btn staades-active"):e[s].setAttribute("class","staades-graph-range-btn")),"1m"==e[s].getAttribute("data-range")&&(void 0===t.links.range1m?e[s].setAttribute("class","staades-graph-range-btn staades-invisible"):e[s].getAttribute("data-range")==a?e[s].setAttribute("class","staades-graph-range-btn staades-active"):e[s].setAttribute("class","staades-graph-range-btn")),"1y"==e[s].getAttribute("data-range")&&(void 0===t.links.range1y?e[s].setAttribute("class","staades-graph-range-btn staades-invisible"):e[s].getAttribute("data-range")==a?e[s].setAttribute("class","staades-graph-range-btn staades-active"):e[s].setAttribute("class","staades-graph-range-btn")),"5y"==e[s].getAttribute("data-range")&&(void 0===t.links.range5y?e[s].setAttribute("class","staades-graph-range-btn staades-invisible"):e[s].getAttribute("data-range")==a?e[s].setAttribute("class","staades-graph-range-btn staades-active"):e[s].setAttribute("class","staades-graph-range-btn"));"highchart"==this.options.layout&&this.drawHighcartLineGraph(t)},StaadesGraph.prototype.initGraphContainer=function(){var t=document.getElementById(this.options.containerId);t.setAttribute("class","staades-graph-container"),t.setAttribute("data-staades-id",this.containerId);var a="";a+='<div class="staades-graph-btns">',a+='<div class="staades-graph-range-btns"><span class="staades-graph-range-btn staades-invisible" data-range="5y">5Y</span><span class="staades-graph-range-btn staades-invisible" data-range="1y">1Y</span><span class="staades-graph-range-btn" data-range="1m">1M</span><span class="staades-graph-range-btn" data-range="1d">1D</span><span class="staades-graph-range-btn" data-range="1h">1H</span></div>',a+='<div class="staades-graph-diff-btns"><span class="staades-graph-diff-btn staades-visible" data-diff="sum">&sum;</span><span class="staades-graph-diff-btn staades-visible" data-diff="diff">&Delta;</span>  </div>',a+=" </div>",a+='<div id="staades-chart-'+this.containerId+'" style="height: '+this.options.height+' "></div>',t.innerHTML=a;for(var e=document.getElementById(this.options.containerId).getElementsByClassName("staades-graph-range-btn"),s=0;s<e.length;s++)e[s].addEventListener("click",function(t){StaadesGraphHandler.rangeBtnClicked(t)});e=document.getElementById(this.options.containerId).getElementsByClassName("staades-graph-diff-btn");for(var s=0;s<e.length;s++)e[s].addEventListener("click",function(t){StaadesGraphHandler.diffBtnClicked(t)})},StaadesGraph.prototype.initGraphObject=function(){"highchart"==this.options.layout&&this.initHighcartLineGraph()},StaadesGraph.prototype.resetGraphObject=function(){if("highchart"==this.options.layout)for(;this.graphObject.series.length>0;)this.graphObject.series[0].remove(!0)},StaadesGraph.prototype.setDateIntervalRange=function(t){localStorage.setItem("staades"+this.containerHash+"range",t),this.values()},StaadesGraph.prototype.setDisplayModus=function(t){localStorage.setItem("staades"+this.containerHash+"display",t),this.values()},StaadesGraph.prototype.mapHighchartValues=function(t){var a,e,s=[],n="",r=localStorage.getItem("staades"+this.containerHash+"display");null==r&&(r="total");for(var i in t.data)a=t.data[i].attributes.granularity_value.toString(),n=t.data[i].attributes.ident_key,e=null==r||"diff"==r?t.data[i].attributes.value_diff:t.data[i].attributes.value_sum,s.push([Date.UTC(a.substring(0,4),a.substring(4,6)-1,a.substring(6,8),a.substring(8,10),a.substring(10,12)),e]);return s.sort(function(t,a){return t[0]>a[0]?1:t[0]<a[0]?-1:0}),{name:n,data:s,animation:!1,marker:{radius:2}}},StaadesGraph.prototype.mapHighchartAggregateValues=function(t){var a=[];for(var e in t.aggregates){var s=t.aggregates[e].date,n=s.substring(0,4),r=s.substring(5,7),i=s.substring(8,10),d=s.substring(11,13),g=s.substring(14,16),o=s.substring(17,19);a.push([Date.UTC(n-0,r-1,i-0,d-0,g-0,o-0),t.aggregates[e].value])}return a.sort(function(t,a){return t[0]>a[0]?1:t[0]<a[0]?-1:0}),{name:t.data.attributes.title,data:a,animation:!1,marker:{radius:2}}},StaadesGraph.prototype.initHighcartLineGraph=function(t){var a={chart:{renderTo:"staades-chart-"+this.containerId,type:"line"},title:{text:""},xAxis:{type:"datetime",dateTimeLabelFormats:{millisecond:"%H:%M:%S",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%d.%b",week:"%d.%b",month:"%b %Y",year:"%Y"},title:{text:"Date",enabled:!1}},yAxis:{title:{enabled:!1}},legend:{enabled:!1},loading:!1,credits:{enabled:!1}};this.graphObject=new Highcharts.Chart(a)},StaadesGraph.prototype.drawHighcartLineGraph=function(t){this.graphObject.addSeries(this.mapHighchartAggregateValues(t),!1),this.graphObject.redraw()},StaadesGraphHandler={rangeBtnClicked:function(t){var a=t.target.parentElement.parentElement.parentElement.getAttribute("data-staades-id"),e=t.target.getAttribute("data-range");window["staades"+a].setDateIntervalRange(e)},diffBtnClicked:function(t){var a=t.target.parentElement.parentElement.parentElement.getAttribute("data-staades-id"),e=t.target.getAttribute("data-diff");window["staades"+a].setDisplayModus(e)}};